rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /games/{gameId} {
      allow list: if request.auth != null && request.auth.uid == resource.data.ownerId;
      allow write: if request.auth != null && request.auth.uid == request.resource.data.ownerId;
      allow read: if true;

      match /players/{playerId} {
        allow read: if true;
        allow write: if get(/databases/$(database)/documents/games/$(gameId)).data.state == "waitingForPlayers";
      }

      match /questions/{questionId} {
        allow read: if true;
        // could check the game's ownerId in the future
        allow write: if request.auth != null;
      }

      match /answers/{answerId} {
        allow read: if true;
        allow write: if get(/databases/$(database)/documents/games/$(gameId)).data.state == "showingQuestion";
      }
    }
  }
}